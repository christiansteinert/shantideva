<!doctype html>
<html class="no-js">
<head>
	<meta charset="UTF-8">
  <!--<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, viewport-fit=cover" />-->
  <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <link rel="stylesheet" type="text/css" href="css/custom.css" />
    <link rel="stylesheet" type="text/css" href="lib/jquery-ui-1.13.2.custom/jquery-ui.min.css" />

    <link rel="icon" href="favicon_180.png" type="image/png" sizes="180x180" />
    <link rel="icon" href="favicon_48.png" type="image/png" sizes="48x48" />    
    <link rel="icon" href="favicon_32.png" type="image/png" sizes="32x32" />    
    <link rel="icon" href="favicon_24.png" type="image/png" sizes="24x24" />    
    <link rel="icon" href="favicon_16.png" type="image/png" sizes="16x16" />    
    <link rel="apple-touch-icon" href="apple_icon180.png" type="image/png" sizes="180x180" />    
    
	<script src="lib/jquery-3.6.1.min.js" charset="UTF-8"></script> 
	<script src="lib/jquery-ui-1.13.2.custom/jquery-ui.min.js" charset="UTF-8"></script> 
	
	<script src="content/localize.js" charset="UTF-8"></script>
	
	<title>Shantideva</title>

<script>

CONFIG = {
  _settings:{},
  _favoriteVerses:{},
    
  isInitialized:function() {
    return !!this._settings.uiLanguage;
  },
  
  isSettingsMigrationNeeded:function(cordovaSettings) {
    // if we don't have cordova settings forthe colorTheme  then we need to persist old settings from the localStorage;
    // if we don't have a uiLanguage in the frontend then we have no settings whatsoever
    return !cordovaSettings.colorTheme || !localStorage.getItem("uiLanguage");
  },
  
  isIOS:function() {
    if(window.cordova && window.cordova.platformId === 'ios')
      return true;

    if ( (/(iPad|iPhone|iPod)/g.test(navigator.platform)) ||
         (/Mac/g.test(navigator.userAgent) && "ontouchend" in document) )
       return true;
        
    if(/(iPad|iPhone|iPod)/g.test(navigator.userAgent))        
      return true;
    
    return false;

  },

  /** get UI language */
  getUILang:function() {
    return this._settings.uiLanguage;
  },

  getPreferredUserLanguage:function() {
    // check if any of the user's preferred language is supported by the app
    if(navigator.languages) {
      for(var i in navigator.languages) {
        var locale = navigator.languages[i].toLowerCase(); // full locale, e.g. zh-CN
        var lang   = locale.substring(0,2); // language, e.g. zh or en
        
        if(lang === 'zh') {
          if(locale.indexOf('hans')) {
            lang = "zh-cn"; // simplified chinese, specified explicitly
          } if(locale.indexOf('hant')||locale.indexOf('tw')||locale.indexOf('hk')||locale.indexOf('mo')) {
            lang = "zh-tw"; // traditional chinese
          } else {
            lang = "zh-cn"; // simplified chinese
          }
        }
        
        if(LANG_LIST[lang]) {
          return lang;
        }
      }
    }

    // check if the browser language is supported by the app
    if (navigator.language && LANG_LIST[navigator.language]) {
      return navigator.language;
    }

    // fall back to English as default
    return 'en';
  },
  
  getMessageEnabled:function() {
    return this._settings.messageEnabled;
  },

  getMessageHour:function() {
    return this._settings.messageHour;
  },

  getFontSize:function() {
    return parseInt(this._settings.fontSize, 10);
  },

  getColorTheme:function() {
    return this._settings.colorTheme;
  },  

  getPreferredColorTheme:function() {
    var prefersDarkScheme = window.matchMedia('(prefers-color-scheme:dark)');
    if(prefersDarkScheme.matches) {
      return 'dark'; // The browser says that the user prefers a dark theme. Use it.
    } else {
      return 'light';
    }
  },

  /** get current text language */
  getTextLang:function() {
    return this._settings.textLanguage;
  },

  getPreferredTextLanguage:function() {
    var uiLang = this.getPreferredUserLanguage();
    if(TEXT_LANG_LIST[uiLang]) {
      return uiLang;
    } else {
      return 'en';
    }    
  },

  getTextLang2:function() {
    return this._settings.textLanguage2;
  },

  getTextLang3:function() {
    return this._settings.textLanguage3;
  },
  
  /* get the CSS class or classes to be used for a language */
  getCssClassForLang:function(lang) {    
    if ( lang === 'bo' || lang === 'ru' || lang === 'ar' || lang === 'zh-cn' || lang === 'zh-tw')
      return lang;
    else if (lang === 'sa-devanagari') 
      return lang;
    else if (lang === 'bo-wylie') 
      return 'latin ' + lang;
    else 
      return 'latin ' + this.getLangCode( lang );
  },

  /** get a language code without locale
   * @param lang a language code with locale
   * @returns the language from that code without locale 
   */
  getLangCode:function(lang) {
    // cut off anything behind dash from the language code
    return lang.replace(/-.*/,'');
  },
  
  getTextUrl:function() {
    return 'content/text_'+this.getTextLang()+'.txt';
  },
  
  getTextUrl2:function() {
    return 'content/text_'+this.getTextLang2()+'.txt';
  },    
  
  getTextUrl3:function() {
    return 'content/text_'+this.getTextLang3()+'.txt';
  },
  
  getSettingsFromLocalStorage:function() {
    var verseOfTheDayTxt = UI.getText("Verse of the Day");
    var settings = {
      uiLanguage: localStorage.getItem("uiLanguage") || this.getPreferredUserLanguage(),
      textLanguage: localStorage.getItem("textLanguage") || this.getPreferredTextLanguage(),
      textLanguage2: localStorage.getItem("textLanguage2") || '',
      textLanguage3: localStorage.getItem("textLanguage3") || '',
      messageEnabled: localStorage.getItem("messageEnabled") === false ? false : true,
      messageHour: localStorage.getItem("messageHour") != null ? localStorage.getItem("messageHour") : 10,
      messageMinute: 0,
      fontSize: localStorage.getItem("fontSize") || 100,
      colorTheme: localStorage.getItem("colorTheme") || this.getPreferredColorTheme(),
      verseOfTheDay: verseOfTheDayTxt
    };
    
    return settings;
  },
  
  /**
   * mix settings from the cordova side with settings from the Javascript UI layer
   */
  mixSettings:function(cordovaSettings, jsSettings) {
    var settings = jsSettings;
    var cordovaSettingsExist = (Object.keys(cordovaSettings).length > 0);
    var jsSettingsExist = !!localStorage.getItem("uiLanguage");

    if(cordovaSettingsExist && !jsSettingsExist) {
      // we have settings in Cordova but settings in localStorage were lost. Prefer cordova settings in most cases
      settings = cordovaSettings;
      if (!cordovaSettings.colorTheme) {
        settings.colorTheme = jsSettings.colorTheme;
      }

    } else if(jsSettingsExist && !cordovaSettingsExist) {
      // we have settings in localStorage but cordova does not return anything. Prefer localStorage settings 
      settings = jsSettings;
    } else {
      settings = jsSettings; 

      // mix settings from localStorage and cordova. Prefer cordova settings where available.
      if('uiLanguage' in cordovaSettings) {
        settings.uiLanguage = cordovaSettings.uiLanguage;
      }
      
      if('textLanguage' in cordovaSettings) {
        settings.textLanguage = cordovaSettings.textLanguage;    
        settings.textLanguage2 = cordovaSettings.textLanguage2;    
        settings.textLanguage3 = cordovaSettings.textLanguage3;    
      }

      if ('messageHour' in cordovaSettings) {
        settings.messageEnabled = cordovaSettings.messageEnabled;
        settings.messageHour = cordovaSettings.messageHour;
        settings.messageMinute = cordovaSettings.messageMinute;
      }

      if ('colorTheme' in cordovaSettings && cordovaSettings.colorTheme) {
        settings.colorTheme = cordovaSettings.colorTheme;
        settings.fontSize = parseInt(cordovaSettings.fontSize, 10);
      } else {
        settings.fontSize = parseInt(settings.fontSize, 10);
      }
    }

    // localized texts come only from UI layer. So always get the text "Verse of the Day" from Javascript
    settings.verseOfTheDay = UI.getText("Verse of the Day", settings.uiLanguage);

    this.saveSettings(settings);
    return settings;
  },

  /* load all settings */
  loadCordovaSettings:function(callbackFunc) {
    this.getCordovaPlugin().loadSettings(
      function(cordovaSettings, favoriteVerseSettings) {
        // user favorite verses and deviceID from cordova if available
        if(favoriteVerseSettings) {
          favoriteVersesCordova = JSON.parse(favoriteVerseSettings);
          if(favoriteVersesCordova.favorite_verses && '1' in favoriteVersesCordova.favorite_verses) {
            CONFIG._favoriteVerses = favoriteVersesCordova.favorite_verses;
            if(!localStorage.getItem('deviceUUID')) {
              localStorage.setItem('deviceUUID', favoriteVersesCordova.device_id);
            }
          }
        }

        if(CONFIG.isSettingsMigrationNeeded(cordovaSettings)) {
          // Load settings from the cordova plugin if there are any.
          // Then mix this with additional default settings. 
          // If necessary then we will save the settings back again so that the 
          // Java code has a new clean state
          CONFIG._settings = CONFIG.mixSettings(cordovaSettings, CONFIG.getSettingsFromLocalStorage());
          callbackFunc();
        } else {
          //we already have the settings that we need on the cordova side and do not need to mix settings from localStorage
          CONFIG._settings = cordovaSettings;
          callbackFunc();
        }
      }
    );
  },

  loadSettings:function() {
    this._settings = CONFIG.getSettingsFromLocalStorage();
  },

  /* save all settings  
   * attributes of the settings object: {messageEnabled:true, messageHour:'10', messageMinute:00, uiLanguage:'en', textLanguage:'en', textLanguage2:''}
   */ 
  saveSettings:function(settings, success, error) {
    for(var setting in settings) {
      // save all configuration properties
      localStorage.setItem(setting, settings[setting] );
    }
    
    this.getCordovaPlugin().saveSettings(settings, success, error);
    
    // update locally cached settings in this class as well
    this._language = settings.uiLanguage;
    this._textLanguage = settings.textLanguage;
    this._textLanguage2 = settings.textLanguage2;
    this._textLanguage3 = settings.textLanguage3;
    this._messageEnabled = settings.messageEnabled;
    this._messageHour = settings.messageHour;
  },
  
  /* get the object of our native cordova plugin */
  getCordovaPlugin:function() {
    if(window.cordova && cordova.plugins && cordova.plugins.DailyVersesPlugin ) {
      // we are running inside of cordova - return the native plugin
      return cordova.plugins.DailyVersesPlugin;
    } else {
      // we are running as web application. Return a dummy object
      return {
        testNotification: function(success, error) {},
        setAlarm: function(success, error) {},
        testTimer: function(success, error) {},
        saveSettings:function(settings, success, error) {},
        loadSettings:function(success, error) {success({}); },
        saveFavoriteVerses:function(success, error) {success()}
      };
    }
  },
  
  /**
   * Get the favorite verses of the user 
   * @returns The result is an object which contains a list of properties for each chapter and within that object, 
   * for any verse that is a property there is a property with the verse number that is set to "1".
   * Note that all properties are string properies to be JSON conformant.
   * For example:
   * { "1":{"5":"1", "7":"1", }, "2":{}, "3":{}, "4":{}, "5":{}, "6":{}, "7":{}, "8":{}, "9":{}, "10":{} }
   * => the user has marked verses 5 and 7 of chapter 1 as favorites.
   */
  getFavoriteVerses:function() {
    if ('1' in this._favoriteVerses) {
      // favorites were already loaded. Just use them.
      return this._favoriteVerses;
    } else {    
      // favorites were not yet loaded. Load them.
      var favorites = localStorage.getItem('favoriteVerses');
      if(favorites) {
        this._favoriteVerses = JSON.parse(favorites);
      } else {
        // favorites were never saved before and are initial. Create an empty object.
        this._favoriteVerses = {};
        for( var chapterNr in DATA.chaptersSizes ) {
          this._favoriteVerses[String(chapterNr)] = {};
        }
      }
      return this._favoriteVerses;
    }
  },
  
  /** 
   * save the information, which verses are favorites of the user 
   */
  saveFavoriteVerses:function() {
    var favoriteVerses = this.getFavoriteVerses();
    localStorage.setItem('favoriteVerses', JSON.stringify(favoriteVerses));
    
    // Remember that the favorite verses should also be sent to the cloud.
    // this information is not personalized but could be used later to develop additional features 
    // if we know which verses are particularly popular.
    localStorage.setItem('favoriteVersesForCloud', JSON.stringify(favoriteVerses));

    this.saveFavoriteVersesToCordova(favoriteVerses);
    this.saveFavoriteVersesToCloud();
  },

  saveFavoriteVersesToCordova:function(favoriteVerses) {
    var cordovaVerseInfo = {
      "device_id":this._getDeviceUUID(),
      "favorite_verses": favoriteVerses,
    };
    CONFIG.getCordovaPlugin().saveFavoriteVerses(JSON.stringify(cordovaVerseInfo));

  },

  saveFavoriteVersesToCloud:function() {
    var versesToSave = localStorage.getItem('favoriteVersesForCloud');
    
    if(versesToSave ) {
      var favoriteVerses = JSON.stringify( this.getFavoriteVerses() );
      var url = 'https://skbmk395bj.execute-api.eu-central-1.amazonaws.com/v1/verses/favorite';

      var payload = {
        "device_id":this._getDeviceUUID(),
        "platform": this.getPlatform(),
        "favorite_verses": favoriteVerses,
      };
      payloadStr = JSON.stringify(payload);
      
      // -> send a request to the cloud to save the favorite verse
      $.ajax({
        method:'POST',
        url:url, 
        data: payloadStr,
        contentType: 'application/json',
        async: true
      }).done(function() {
        // verses were successfully pushed to the cloud. Clear the local information that needed to be pushed
        localStorage.setItem('favoriteVersesForCloud', '');
      });
    }
  },
  
  getPlatform:function() {
    if(window.cordova) {
      if(this.isIOS()) {
        return "ios";
      } else {
        return "android";      
      }
    } else {
      return "web";
    }
  },
  
  /**
   * toggle the state whether a verse is currently a favorite and save that change.
   * @param chapter
   * @param verse
   */
  toggleVerseFavorite:function(chapter, verse) {
    this.getFavoriteVerses();
    var chap = this._favoriteVerses[String(chapter)];
    if(chap[String(verse)]) {
      // verse was a favorite before -> delete it from favorites
      delete chap[String(verse)];
    } else {
      // verse was no favorite before -> add it to favorites
      chap[String(verse)] = '1';
    }
    this.saveFavoriteVerses();
  },
  
  
  /**
   * create a random-based UUID for this App instance
   * @returns a UUID that can be used as unique ID for this installation. This is used to send the list of favorite verses to the server. No user-specific data is stored in conjunction with this;  
   * the information is simply used to get an idea which verses are particulaly popular; this may help with developing new features in the future.
   */
  _createUUID:function() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) { var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8); return v.toString(16); });
  },
  
  _getDeviceUUID:function() {
    var deviceId = localStorage.getItem('deviceUUID');    
    if(!deviceId) {
      deviceId = this._createUUID();
      localStorage.setItem('deviceUUID', deviceId);    
    }

    return deviceId;
  }
};

UI = {
  currentChapter: -1,
  _isSettingsInitialized:false,
  _lastPauseTime:null,
  _activeTab:null,

  _setDropdownValues:function(dropdownId, options, selectedOption ) {
      var optHtml='';
      for(var opt in options) {
        optHtml += '<option value="'+ opt +'">'+ options[opt] +'</option>';
      }
      var $dropdown = $('#'+dropdownId);
      $dropdown.html( $dropdown.html() + optHtml );      
      $dropdown.val(selectedOption);
  }, 

  getSettingsFromUI:function() {
    var uiLang = $('#uiLanguage').val();
    if(!LANG_LIST[uiLang]) {
      uiLang = 'en';
    }
    var verseOfTheDayTxt = UI.getText("Verse of the Day");
    verseOfTheDayTxt = verseOfTheDayTxt.replace(/&shy;/g, ''); 
    verseOfTheDayTxt = verseOfTheDayTxt.replace(/&[^;]*;/g, ' '); // replace any HTML entities with spaces
    var settings = {
      uiLanguage: uiLang,
      fontSize: parseInt($('#fontSize').val(), 10),
      colorTheme: $('#colorTheme').val(),
      textLanguage: $('#textLanguage').val(),
      textLanguage2: $('#textLanguage2').val(),
      textLanguage3: $('#textLanguage3').val(),
      messageEnabled: $('#messageEnabled').is(":checked"),
      messageHour: parseInt($('#messageHour').val(), 10),
      messageMinute: 0,
      verseOfTheDay: verseOfTheDayTxt
    };
    
    if(!settings.textLanguage2) {
      settings.textLanguage2 = '';
    }
    return settings;
  },
  
  onPause:function() {
    this._lastPauseTime = new Date();
  },

  /**
    * get the button code for a liking / unliking a verse
    */
  createLikeButtonCode:function(chapter, verse) {
    var favorites = CONFIG.getFavoriteVerses();
    var isLiked = favorites[String(chapter)][String(verse)];
    var cssClass = isLiked?'liked':'unliked';
    
    return '<a href="#" class="likeBtn likeBtn'+chapter+'_'+verse+' '+cssClass+'" onclick="return UI.onLikeButton('+chapter+','+verse+');"></a>';
  },
  
  onLikeButton:function(chapter, verse) {
    CONFIG.toggleVerseFavorite(chapter, verse);
    
    var favorites = CONFIG.getFavoriteVerses();
    var isLiked = favorites[String(chapter)][String(verse)];
    var cssClass = isLiked?'liked':'unliked';

    $('.likeBtn'+chapter+'_'+verse).removeClass('liked').removeClass('unliked').addClass(cssClass);
    CONFIG.saveFavoriteVerses();
    UI.setFavoritesBtnVisibility();
    
    return false;
  },
  
  /**
   * Control the visibility of the "Favorite Verses" tab.
   * Only if favorite verses exist, this tab is shown.
   */ 
  setFavoritesBtnVisibility:function() {
    var favorites = CONFIG.getFavoriteVerses();
    var hasFavorites = false;

    // check if there are any favorite verses
    for(var chapter in favorites) {
      for(var verse in favorites[chapter]) {
        hasFavorites = true;
        break; // leave inner loop
      }
      
      if(hasFavorites) {
        break; // leave outer loop
      }
    }
    
    if(hasFavorites) {
      $('#favoritesTabBtn').show();
    } else {
      $('#favoritesTabBtn').hide();
    }
  },
  

  onResume:function() {
    if(this._activeTab === 'homeTab') {
      // Refresh the content of the home tab when the app was in background to make sure 
      // that the home tab definitely shows the current verse of the day even after a date rollover.
      // If a tab other than the home tab is active at the moment then we don't need to do anything 
      // because the content of that tab will be refreshed if the user clicks on it.
      this.openTab('homeTab');
      
    } else if(this._lastPauseTime) {
      // if the app was in the background for more than 1 hour
      // then reload to refresh the view and show the initial view again
      var now = new Date();
      var elapsedTimeMillis = now.getTime() - this._lastPauseTime.getTime();
      
      if (elapsedTimeMillis > 3600000 ) { 
        location.reload();
      }
    }
    
    this._lastPauseTime = null;
  },
  
  
  btnSave:function() {
    var settings = this.getSettingsFromUI();
    CONFIG.saveSettings(settings);
    location.reload();
  },

  btnCancel:function() {
    location.reload();
  },


  initSettingsTab:function() {
    if(!this._isSettingsInitialized) {
      if(!window.cordova) {
        $("#settingsTab").addClass("web");
      }
      $("#settingsTab").addClass( CONFIG.getCssClassForLang(CONFIG.getUILang()) );
    
      $("#messageEnabled").prop("checked", CONFIG.getMessageEnabled() );
      $("#messageHour").val(CONFIG.getMessageHour() );
      $("#fontSize").val(CONFIG.getFontSize());
      $("#colorTheme").val(CONFIG.getColorTheme());

      $("#settingsTab input[type=checkbox]").checkboxradio();
      //$("#settingsTab select").selectmenu();
      $("#settingsTab button").button();
      
      /* language dropdowns for text language */
      this._setDropdownValues('textLanguage', TEXT_LANG_LIST, CONFIG.getTextLang());      
      this._setDropdownValues('textLanguage2', TEXT_LANG_LIST, CONFIG.getTextLang2());
      this._setDropdownValues('textLanguage3', TEXT_LANG_LIST, CONFIG.getTextLang3());
      
      /* language dropdowns for text language */
      this._setDropdownValues('uiLanguage', LANG_LIST, CONFIG.getUILang());      


      $("#saveBtn").click(function( event ) { UI.btnSave(); }); 
      $("#cancelBtn").click(function( event ) { UI.btnCancel(); }); 
      
      this._isSettingsInitialized = true;
    }
  },
  
  /* activate a given tab and initialize the state of that tab beforehand if needed */
  openTab:function(tabName) {
    if(tabName === 'homeTab') {
      this.updateVerseOfTheDay();
    } else if(tabName === 'textTab') {
      if(this.currentChapter === -1) {
        this.showChapter(1);
      }
    } else if(tabName === 'favoritesTab') {
      this.initFavoriteVersesTab();      
    } else if(tabName === 'settingsTab') {
      this.initSettingsTab();
    }
    
    this._doOpenTab(tabName);
    this.scrollElementToTop($('#'+tabName)[0]);
  },
  
  /* internal helper function: activate a given tab */
  _doOpenTab:function(tabName) {
    $('.tabcontent').hide(); // hide all tab content
    $('#'+tabName).show(); // show desired tab content
    
    $('.tabtitle').hide(); // hide all tabs titles
    $('#'+tabName+"Title").show(); // show title of desired tab
    $('#footer .tab').show(); // make sure the footer becomes visible
    
    $('.tab li').removeClass("active"); // make the currently active tab inactive
    $('#'+tabName+"Btn").parent().addClass("active"); // make the newly selected tab active

    this._activeTab = tabName;  
  },

  /* internal helper function: replace all occurrences of a substring with anoter substring*/
  _replaceAll:function(str, search, replace) {
    return str.split(search).join(replace);
  },
  
  /** Localize a text */
  getText:function(txtid, lng) {
    var lang = lng || CONFIG.getUILang();
    var txt = "";
    if (window.LANG && LANG[lang]) {
      txt = LANG[lang][txtid];
    } 
    if(!txt) {
      txt = txtid;
    }
    
    if(arguments.length > 2) { // additional placeholders present
      for(var i=1;i<arguments.length;i++) {
        txt = txt.replace('%'+i,arguments[i+1]);
      }
    }

    return txt;
  },

  /*localize all texts within the initial page*/
  localizeText:function() {
    var htmlCode = $('#bodyContent').html();
    if (window.LANG && LANG[CONFIG.getUILang()]) {
      for(var txtid in LANG[CONFIG.getUILang()]) {
        var textVal = LANG[CONFIG.getUILang()][txtid];
        htmlCode = this._replaceAll(htmlCode,"{{"+txtid+"}}",textVal);
      }
    }
    htmlCode = this._replaceAll(htmlCode,"{{","");
    htmlCode = this._replaceAll(htmlCode,"}}","");
    $('#bodyContent').html(htmlCode);
    
    var lang = CONFIG.getLangCode( CONFIG.getUILang() );    
    $('#bodyContent').attr('lang',lang);

    $('.header,.footer').addClass( CONFIG.getCssClassForLang(CONFIG.getUILang()) );
  },
  
  scrollElementIntoView:function(scrollParent, targetElement, deltaOffset) {  
    if(!deltaOffset) {
      deltaOffset=0;
    }
    scrollParent.parentNode.scrollTop = targetElement.offsetTop + deltaOffset;
    $(targetElement).effect("highlight", {}, 1500);
  },
  
  scrollElementToTop:function(scrollParent) {  
    scrollParent.parentNode.scrollTop = 0;
  },
  
  jumpToVerseOfTheDay:function() {
    var verseInfo = DATA.getVerseOfTheDay(1);
    this.jumpToVerse(verseInfo);
  },

  jumpToVerse:function(verseInfo) {
    this.showChapter(verseInfo.chapter);
    this.openTab('textTab');
    
    var verseId = '#verse'+verseInfo.totalNr;
    var verseDom = $(verseId);
    this.scrollElementIntoView($('#textTab')[0], verseDom[0], -8);
  },

  updateVerseOfTheDay:function() {
    var verseInfo = DATA.getVerseOfTheDay(1);
    var verseInfo2 = DATA.getVerseOfTheDay(2);
    var verseInfo3 = DATA.getVerseOfTheDay(3);
    var verseText = DATA.getVerseText( verseInfo );
    var verseText2 = DATA.getVerseText( verseInfo2 );
    var verseText3 = DATA.getVerseText( verseInfo3 );
    var langCode1 = CONFIG.getTextLang();
    var langCode2 = CONFIG.getTextLang2();
    var langCode3 = CONFIG.getTextLang3();
    var cssClass = CONFIG.getCssClassForLang(langCode1);
    var cssClass2 = CONFIG.getCssClassForLang(langCode2);
    var cssClass3 = CONFIG.getCssClassForLang(langCode3);
    var lang = CONFIG.getLangCode(langCode1);
    var lang2 = CONFIG.getLangCode(langCode2);
    var lang3 = CONFIG.getLangCode(langCode3);

    var likeBtn = UI.createLikeButtonCode(verseInfo.chapter, verseInfo.nr);
    verseText = verseText.replace(/<\/p>$/,likeBtn+'</p>');
    
    htmlCode = '<div id="verseOfTheDayCont" class="vcenterContainer"><div id="verseOfTheDay" class="vcenter">';
    htmlCode += '<div id="verseOfTheDayNarrow">';

    htmlCode += '<div class="verse '+cssClass+'" lang="'+lang+'">';
    htmlCode += verseText;
    
    htmlCode += '</div>';

    htmlCode += '<p><a href="javascript:void(0)" onclick="UI.jumpToVerseOfTheDay()" class="btn" title="'+this.getText('Jump to this verse in the text.')+'">'+this.getText('Chapter %1, Verse %2', CONFIG.getUILang(), verseInfo.chapter, verseInfo.nr)+'</a></p>';

    if(verseText2) {
      htmlCode += '<div class="verse '+cssClass2+'" lang="'+lang2+'">';
      htmlCode += verseText2;
      htmlCode += '</div>';
      htmlCode += '<p><a href="javascript:void(0)" onclick="UI.jumpToVerseOfTheDay()" class="btn" title="'+this.getText('Jump to this verse in the text.')+'">'+this.getText('Chapter %1, Verse %2', CONFIG.getUILang(), verseInfo.chapter, verseInfo.nr)+'</a></p>';
    }

    if(verseText3) {
      htmlCode += '<div class="verse '+cssClass3+'" lang="'+lang3+'">';
      htmlCode += verseText3;
      htmlCode += '</div>';
      htmlCode += '<p><a href="javascript:void(0)" onclick="UI.jumpToVerseOfTheDay()" class="btn" title="'+this.getText('Jump to this verse in the text.')+'">'+this.getText('Chapter %1, Verse %2', CONFIG.getUILang(), verseInfo.chapter, verseInfo.nr)+'</a></p>';
    }
    
    if(UI._developer) {
      htmlCode += '<p style="height:500px;">';
      htmlCode += '<p><input id="setVerseNr" /><a href="#" onclick=\'location.href=location.pathname+"?verse="+$("#setVerseNr").val()\'>Go to Verse</p>';
    }
    
    htmlCode += '</div></div></div>';
    $('#homeTab').html(htmlCode);
    
    $('#homeTab a.btn').button();
    
    $('#homeTabTitle h1').on('touchend mouseup', function(){ UI.titleClick(); });
  },
  
  titleClick:function() {
    if(!UI._clicked )
      UI._clicked = 1;
    else 
      UI._clicked += 1;
    
    if(UI._clicked >= 10) {
      UI._developer = true;
      UI.updateVerseOfTheDay();
    }
  },

  showChapter:function(chapterNr) {
    if(this.currentChapter != chapterNr) {
        var langCode1 = CONFIG.getTextLang();
        var cssClass = CONFIG.getCssClassForLang(langCode1);
        var langCode2 = CONFIG.getTextLang2();
        var cssClass2 = CONFIG.getCssClassForLang(langCode2);
        var langCode3 = CONFIG.getTextLang3();
        var cssClass3 = CONFIG.getCssClassForLang(langCode3);
        var lang = CONFIG.getLangCode(langCode1);
        var lang2 = CONFIG.getLangCode(langCode2);
        var lang3 = CONFIG.getLangCode(langCode3);
    
        if(chapterNr < 1) {
          chapterNr = 1;
        } else if(chapterNr >= DATA.chaptersSizes.length - 1) {
          chapterNr = DATA.chaptersSizes.length - 1;
        }
        $('#textTabTitle').attr('lang',CONFIG.getLangCode(lang));
        $('#textTabTitle').addClass(CONFIG.getCssClassForLang(lang));
        
        // select the right chapter in the dropdown
        $('#chapterDropdown select').val(chapterNr).selectmenu("refresh");
        
        // show the chapter content on the "full text" tab
        var htmlCode = '<div class="textView"><div><h1 class="'+cssClass+'" lang="'+lang+'">'+DATA.chaptersNames[chapterNr] + '</h1></div>';
        if(lang2 && DATA.chaptersNames2[chapterNr]) {
          htmlCode += '<div><h1 class="'+cssClass2+'" lang="'+lang2+'">'+DATA.chaptersNames2[chapterNr]+ '</h1></div>';
        }
        if(lang3 && DATA.chaptersNames3[chapterNr]) {
          htmlCode += '<div><h1 class="'+cssClass3+'" lang="'+lang3+'">'+DATA.chaptersNames3[chapterNr]+ '</h1></div>';
        }
        
        for(var i=0;i<DATA.verses.length;i++) {
          var verse=DATA.verses[i];
          if(verse.chapter === chapterNr) {
            var likeBtn = UI.createLikeButtonCode(verse.chapter, verse.nr);
             
            htmlCode+='<div class="verse '+cssClass+'" lang="'+lang+'" id="verse'+verse.totalNr+'">' + verse.verseText.replace(/<\/p>$/,likeBtn+'</p>') + '</div>';
            if(lang2 && DATA.verses2.length > i) {
              var verse2=DATA.verses2[i];
              var verseText2 = DATA.getVerseText(verse2);
              htmlCode+='<div class="verse '+cssClass2+'" lang="'+lang2+'" id="verse'+verse.totalNr+'b">' + verseText2 + '</div>';
            }
            if(lang3 && DATA.verses3.length > i) {
              var verse3=DATA.verses3[i];
              var verseText3 = DATA.getVerseText(verse3);
              htmlCode+='<div class="verse '+cssClass3+'" lang="'+lang3+'" id="verse'+verse.totalNr+'c">' + verseText3 + '</div>';
            }
            htmlCode += '<div class="verseSpacer"></div>';
          }
        }
        
        htmlCode+='</div>';
        var $textTab = $('#textTab');
        $textTab.html(htmlCode);
        this.scrollElementToTop($textTab[0]);
        
        this.currentChapter = chapterNr;
    }
  },

  initFavoriteVersesTab:function() {
    var langCode1 = CONFIG.getTextLang();
    var cssClass = CONFIG.getCssClassForLang(langCode1);
    var langCode2 = CONFIG.getTextLang2();
    var cssClass2 = CONFIG.getCssClassForLang(langCode2);
    var langCode3 = CONFIG.getTextLang3();
    var cssClass3 = CONFIG.getCssClassForLang(langCode3);
    var lang = CONFIG.getLangCode(langCode1);
    var lang2 = CONFIG.getLangCode(langCode2);
    var lang3 = CONFIG.getLangCode(langCode3);

    // show the chapter content on the "full text" tab
    var htmlCode = '<div class="textView">';
    var favorites = CONFIG.getFavoriteVerses();
    var lastShownChapterTitle = 0;
    var titlesCount = 0;
    
    for(var i=0;i<DATA.verses.length;i++) {
      var verse=DATA.verses[i];
      if(favorites[String(verse.chapter)][String(verse.nr)]) {
        if(lastShownChapterTitle != verse.chapter) {
          // show chapter title
          if(titlesCount>0) {
            htmlCode += '<div class="chapterSpacer"></div>';
          }
          
          htmlCode += '<div><h1 class="'+cssClass+'" lang="'+lang+'">'+DATA.chaptersNames[verse.chapter] + '</h1></div>';
          if(lang2 && DATA.chaptersNames2[verse.chapter]) {
            htmlCode += '<div><h1 class="'+cssClass2+'" lang="'+lang2+'">'+DATA.chaptersNames2[verse.chapter]+ '</h1></div>';
          }
          if(lang3 && DATA.chaptersNames3[verse.chapter]) {
            htmlCode += '<div><h1 class="'+cssClass3+'" lang="'+lang3+'">'+DATA.chaptersNames3[verse.chapter]+ '</h1></div>';
          }
          lastShownChapterTitle = verse.chapter;
          titlesCount++; 
        }
      

        var verseText = DATA.getVerseText(verse);
        var likeBtn = UI.createLikeButtonCode(verse.chapter, verse.nr);
        var jumpBtn = '<a href="javascript:void(0)" onclick="UI.jumpToVerse(DATA.verses['+i+'])" class="btn small" title="'+this.getText('Jump to this verse in the text.')+'">'+verse.chapter+':'+verse.nr+'</a>';
        var verseWithButtons = verseText.replace(/<\/p>$/,likeBtn+'</p>');
        verseWithButtons = verseWithButtons.replace(/<p>/,'<p>'+jumpBtn);
        
        htmlCode+='<div class="verse '+cssClass+'" lang="'+lang+'" id="verse'+verse.totalNr+'">' + verseWithButtons + '</div>';
        if(lang2 && DATA.verses2.length > i) {
          var verse2=DATA.verses2[i];
          var verseText2 = DATA.getVerseText(verse2);
          //verseText2 = verseText2.replace(/<p>/,'<p>'+jumpBtn);
          htmlCode+='<div class="verse '+cssClass2+'" lang="'+lang2+'" id="verse'+verse.totalNr+'b">' + verseText2 + '</div>';
        }
        if(lang3 && DATA.verses3.length > i) {
          var verse3=DATA.verses3[i];
          var verseText3 = DATA.getVerseText(verse3);
          //verseText3 = verseText3.replace(/<p>/,'<p>'+jumpBtn);
          htmlCode+='<div class="verse '+cssClass3+'" lang="'+lang3+'" id="verse'+verse.totalNr+'c">' + verseText3 + '</div>';
        }
        htmlCode += '<div class="verseSpacer"></div>';
      }
    }
    
    htmlCode+='</div>';
    var $favoritesTab = $('#favoritesTab');
    $favoritesTab.html(htmlCode);
    $('#favoritesTab .btn').button();
    this.scrollElementToTop($favoritesTab[0]);
  },
    
  moveChapter:function(direction) {
    var newChapter = this.currentChapter + direction;
    this.showChapter(newChapter);
  },
  
  initChaptersDropdown:function() {
    var htmlCode = '<select>';
    for(var chapter in DATA.chaptersNames) {
      htmlCode += '<option value="'+chapter+'">'+DATA.chaptersNames[chapter]+'</option>';
    }
    htmlCode += '</select>';

    var cssClass = CONFIG.getCssClassForLang(CONFIG.getTextLang());
    $('#chapterDropdown').addClass(cssClass);
    $('#chapterDropdown').html(htmlCode);
    
    var $select = $('#chapterDropdown select').selectmenu();

    $select.on("selectmenuchange",function() {
      UI.showChapter(Number($select.val()));
    });
    
    if( CONFIG.getUILang() === 'ar') {
     $('#btnBack').button({icon:'ui-icon ui-icon-caret-1-e'});
     $('#btnNext').button({icon:'ui-icon ui-icon-caret-1-w'});
    } else {
     $('#btnBack').button({icon:'ui-icon ui-icon-caret-1-w'});
     $('#btnNext').button({icon:'ui-icon ui-icon-caret-1-e'});
    }
  },
  
  init:function() {
    this.initChaptersDropdown();
    this.openTab('homeTab');
  }

};

DATA = {
  verses:[],
  verses2:[],
  verses3:[],
  chaptersNames:[],
  chaptersNames2:[],
  chaptersNames3:[],
  chaptersSizes:[],
  chaptersSizes2:[],
  chaptersSizes3:[],
  languageCount:0,
  languagesInitialized:0,

  loadVerses:function(settings) {
    DATA.languageCount++;
    $.ajax({url:CONFIG.getTextUrl(), async: true, success:$.proxy(DATA.parseVerses1,DATA)});
    
    if(CONFIG.getTextLang2()) {
      DATA.languageCount++;
      $.ajax({url:CONFIG.getTextUrl2(), async: true, success:$.proxy(DATA.parseVerses2,DATA)});
    }

    if(CONFIG.getTextLang3()) {
      DATA.languageCount++;
      $.ajax({url:CONFIG.getTextUrl3(), async: true, success:$.proxy(DATA.parseVerses3,DATA)});
    }
  },
  
  parseVerses1:function(text) {
    this.parseVerses(text,1);
  },
  
  parseVerses2:function(text) {
    this.parseVerses(text,2);
  },
  
  parseVerses3:function(text) {
    this.parseVerses(text,3);
  },

  parseVerses:function(text, langNum) {
    if(text.indexOf('***') !== 0) {
        return;
    }

    var data = [],
        lines=text.split('\n'),
        count=lines.length,
        record,
        verseNr=0,
        chapterNr=0,
        verse='',
        sortPosition='',
        currLine;
    
    for (var i = 0; i < count; i++) {
      currLine = lines[i];
      currLine = currLine.replace(/ །/,"&nbsp།"); // add non-breaking space before Tibetan shad
      currLine = currLine.replace(/་/g,"་&#x200b;"); // add zero-width space after Tibetan tseg to allow line breaking
      currLine = currLine.replace(/•/g,"&shy;"); // replace • with a soft hyphen to allow line breaking (for Sanskrit)
      
      if(currLine.indexOf('***')>=0) {
          chapterNr++;
          var chapterName = currLine.replace(/ *[*]+ ?/g,'');
          if(langNum===1) {
            this.chaptersNames[chapterNr] = chapterName;
          } else if(langNum===2) {
            this.chaptersNames2[chapterNr] = chapterName;
          }  else if(langNum===3) {
            this.chaptersNames3[chapterNr] = chapterName;
          }
          
          if(verse!=='') {
            data.push({id:chapterNr+'_'+verseNr, totalNr:i-1, chapter:chapterNr, nr:verseNr, verseText: verse, getId:function(){return id;}});
          }

          verseNr=1;
          verse='';
          
      } else if(currLine === '') {
          if(verse!=='') {
            data.push({id:chapterNr+'_'+verseNr, totalNr:i-1, chapter:chapterNr, nr:verseNr, verseText: verse, getId:function(){return id;}});
          
            verseNr++;
            verse='';
          }
      } else {
          verse += '<p>'+ currLine+'</p>';
          //verse += currLine+'<br>';
      }
      
      if(langNum===1) {        
        this.chaptersSizes[chapterNr] = verseNr - 1;
      } else if(langNum===2)  {
        this.chaptersSizes2[chapterNr] = verseNr - 1;
      } else if(langNum===3)  {
        this.chaptersSizes3[chapterNr] = verseNr - 1;
      }
    }
    
    if(langNum===1) {        
      this.verses = data;
    } else if(langNum===2) {        
      this.verses2 = data;
    } else if(langNum===3) {        
      this.verses3 = data;
    }    

    this.languagesInitialized++;

    if(this.languagesInitialized === this.languageCount) {
      run();
    }
  },
    
   /**
    * helper function - calculate a random integer value based on a random seed
    * @param seed the seed to initialize the random number generation
    * @param maxValue the highest value that may be returned (random numbers will be between 0 and this value, inclusive)
    * @return a random integer value
    */
  getRandomIntWithSeed: function(seed,maxValue) {
    var randomNumber = Number("0." + (Math.sin(seed).toString().substring(7)));
      return parseInt((maxValue+1)*randomNumber, 10);
  },
  
  getVerseOfTheDay: function(langNum) {
    var now=new Date();
    while(true) {
      var verseInfo = this.doGetVerseOfTheDay(langNum, now);
      if(verseInfo === null) {
        return null;
      } else if(this.isDummyVerse(verseInfo.verseText)) {
        // This verse does not exist in the  given language. Jump back one year to see if we have a reasonable verse there.
        now.setFullYear(now.getFullYear()-1);
      } else {
        // We found a verse that exists. Return it.
        return verseInfo; 
      }
    }
  },

  doGetVerseOfTheDay: function(langNum, day) {
    if(this.verses2.length === 0 && langNum === 2 ) {
      return null; // don't return anything for the second language if it was not loaded
    }
    if(this.verses3.length === 0 && langNum === 3 ) {
      return null; // don't return anything for the third language if it was not loaded
    }
    var totalVerseCount = this.verses.length;
    var verseOfTheDayNr;

    if((location.href.indexOf('?verse=')>0)||(navigator.platform.indexOf('Simulator')>0)) {
        // demo mode - URL parameter ?verse=123
        verseOfTheDayNr = Number(location.href.replace(/.*\?verse=/g,''));
    } else {
        // calculate a seed for the random number generator that will be stable for each day;
        //  then use it to get the random verse for today
        var now=day||new Date();
        var randSeedForTheDay = now.getFullYear()*400+now.getMonth()*31+now.getDate();
        verseOfTheDayNr = this.getRandomIntWithSeed(randSeedForTheDay, totalVerseCount - 1);
    }

    if(langNum===1) {
      return this.verses[verseOfTheDayNr];
    } else if(langNum===2) {
      return this.verses2[verseOfTheDayNr];
    } else if(langNum===3) {
      return this.verses3[verseOfTheDayNr];
    }
  },
  
  getVerseText:function(verseInfo) {
    if(verseInfo) {
      var verseText = verseInfo.verseText;
      verseText = verseText.replace(/^<p>\([0-9]+\) */,"<p>"); // remove verse number at the beginning of the first line
      verseText = verseText.replace(/^<p>\([١٢٣٤٥٦٧٨٩٠]+\) */,"<p>"); // remove Arabic verse number at the beginning of the first line
      verseText = verseText.replace(/^<p>[༡༢༣༤༥༦༧༨༩༠]+༽ */,"<p>།"); // remove Tibetan verse number at the beginning of the first line
      verseText = verseText.replace(/^<p>\([१२३४५६७८९०]+\) */,"<p>"); // remove Devanagari verse number at the beginning of the first line
      return verseText;
    } else {
      return null;
    }
  },
  
  isDummyVerse:function(verseText) {
    if((verseText.indexOf('[[') > 0) || (verseText.length < 15))
      return true;
    else
      return false;
  }
};


/*** Initialization Stuff ***/
/* do final initialization. On mobile devices this is run only after Cordova has been initialized. */
function finalInit() {
  // push favorite verses to cloud if it has not happened yet.
  CONFIG.saveFavoriteVersesToCloud();
}


/* initialize the UI */
function run() { 
  UI.localizeText();
  UI.init();

  var uiLangCssClass = 'uilang-' + CONFIG.getCssClassForLang(CONFIG.getUILang());
  $('body').addClass(uiLangCssClass).addClass(CONFIG.getColorTheme());

  var fontSize = CONFIG.getFontSize() / 100;
  // if size < 100% then only make the font in the content area Smaller 
  // Likewise, if the screen is small, don't allow zooming the header and footer too much and instead only zoom the content area   
  if(fontSize < 1 || (fontSize > 1.5 && window.innerWidth < 800) || (fontSize > 1.3 && window.innerWidth < 500) || (fontSize > 1.1 && window.innerWidth < 400)  || (window.innerWidth < 300)) {
    // the header and footer would become too small or too big: only zoom the content area to the full size
    $('.tabcontent').css('font-size', fontSize + 'em');
    
    // set the footer and header size to the max. value that is doable
    var footerSize = 1.0;
    if(window.innerWidth >= 400) 
      footerSize = 1.1;
    if(window.innerWidth >= 500) 
      footerSize = 1.3;
    if(window.innerWidth >= 800) 
      footerSize = 1.5;      
    if(fontSize<footerSize)
      footerSize = fontSize;
    if(footerSize < 1.0)
      footerSize = 1.0;

    $('.footer,.header').css('font-size', footerSize + 'em');
  } else {
    // we are enlarging and there seems to be enough space ->  enlarge the header and footer 
    $('body').css('font-size', fontSize + 'em');
  }
    
  if(!window.localStorage) {
    // if the browser doesn't support local storage we can't store settings so we have to hide the settings tab.
    $('#settingsTabBtn').hide();
  }
    
  if(navigator.userAgent.indexOf('Android 4') >=4) {
    // add a class to the body on Android 4 to allow CSS workarounds
    $("body").addClass("android4");
  }
  
  if(CONFIG.isIOS()) {
    $("body").addClass("ios");
  }
  UI.setFavoritesBtnVisibility();  
  $('.hiddenOnStartup').removeClass('hiddenOnStartup');
 
  finalInit();
}

/* Do cordova-specific initializations */
function cordovaReady() {
  // Cordova is ready now.
  // do the UI initialization
  $("body").addClass("mobile"); 
  $("body").addClass("cordova"); 
  
  // the initialization of the UI has not happened yet. Trigger it now and do a config migration if needed
  CONFIG.loadCordovaSettings(function() {    
    DATA.loadVerses();
    CONFIG.getCordovaPlugin().setAlarm();
    
    // register for pause / resume events and make sure that the Java part initializes the timer for the notification message 
    document.addEventListener("pause", function() { UI.onPause(); });
    document.addEventListener("resume", function() { window.setTimeout(function(){UI.onResume();}, 1); });
  });

}

if(location.href.indexOf('https://localhost') === 0 || location.href.indexOf('file://') === 0) {
  // running inside cordova  
  // add handler to do the rest of the initialization when Cordova is ready
  document.addEventListener("deviceready", function() { $(cordovaReady); });  
} else {
  // running inside the browser
  // We do not need Cordova. Initialize the UI as soon as jQuery is ready
  $(function() {
    CONFIG.loadSettings();
    DATA.loadVerses();
    finalInit();
  });
}

</script>

</head>
<body>
  <div id="bodyContent">
    <div class="header" id="header">
      <div class="tabtitle" id="homeTabTitle">
        <h1>{{App_Title}} - {{Verse of the Day}}</h1>
      </div>
      <div class="tabtitle" id="textTabTitle">
        <a href="javascript:void(0)" id="btnBack" onclick="UI.moveChapter(-1)"></a>
        <span id="chapterDropdown"></span>
        <a  href="javascript:void(0)" id="btnNext" onclick="UI.moveChapter(+1)"></a>
      </div>
      <div class="tabtitle" id="favoritesTabTitle">
        <h1>{{Favorite Verses}}</h1>
      </div>
      <div class="tabtitle" id="settingsTabTitle">
        <h1>{{Settings}}</h1>
      </div>
      <div class="tabtitle" id="infoTabTitle">
        <h1>{{About This App}}</h1>
      </div>  
    </div>

    <div class="tabcontentWrap">
      <div id="homeTab" class="tabcontent">
        <div class="vcenterContainer">
          <div class="vcenter">
            <img src="content/info-logo.png" style="max-width:60vmin;" width="300" />    
          </div>
        </div>
      </div>

      <div id="textTab" class="tabcontent hiddenOnStartup">
      </div>

      <div id="favoritesTab" class="tabcontent hiddenOnStartup">
      </div>
      
      <div id="settingsTab" class="tabcontent hiddenOnStartup">
        <div class="vcenterContainer settings"><div class="vcenter">
        
          <fieldset>
          <legend>{{Language of Shantideva's text}}</legend>
          <form>
          <p class="smallFormInfo">{{You can show the text in up to three different languages at the same time in order to compare different translations.}}</p>
          <table width="100%">
          <tr>
            <td><label for="textLanguage" class="label">{{Text Language}}:</label></td>
            <td><select id="textLanguage"></select></td>
          </tr>
          <tr>
            <td><label for="textLanguage2" class="label">{{Text Language 2}}:</label></td>
            <td><select id="textLanguage2"><option value=""> ---------------- </option></select></td>
          </tr>
          <tr>
            <td><label for="textLanguage3" class="label">{{Text Language 3}}:</label></td>
            <td><select id="textLanguage3"><option value=""> ---------------- </option></select></td>
          </tr>
          </table>
          </form>
          </fieldset>
          
          <fieldset class="hideForWeb">
          <legend>{{Notification Messages}}</legend>
          <p class="smallFormInfo">{{Enable the options below to see the verse of the day as a notification message.}}</p>
          <form>
          <table width="100%">
          <tr>
              <td><span class="label">{{Daily Message}}:</span></td>
              <td><label for="messageEnabled">{{Show Messages}}</label> <input type="checkbox" name="messageEnabled" id="messageEnabled"></td>
          </tr>
          <tr>
              <td><label for="messageHour" class="label">{{Time}}:</label></td>
              <td><select name="messageHour" id="messageHour">
                <option value="1">{{1:00}}</option>
                <option value="2">{{2:00}}</option>
                <option value="3">{{3:00}}</option>
                <option value="4">{{4:00}}</option>
                <option value="5">{{5:00}}</option>
                <option value="6">{{6:00}}</option>
                <option value="7">{{7:00}}</option>
                <option value="8">{{8:00}}</option>
                <option value="9">{{9:00}}</option>
                <option value="10">{{10:00}}</option>
                <option value="11">{{11:00}}</option>
                <option value="12">{{12:00}}</option>
                <option value="13">{{13:00}}</option>
                <option value="14">{{14:00}}</option>
                <option value="15">{{15:00}}</option>
                <option value="16">{{16:00}}</option>
                <option value="17">{{17:00}}</option>
                <option value="18">{{18:00}}</option>
                <option value="19">{{19:00}}</option>
                <option value="20">{{20:00}}</option>
                <option value="21">{{21:00}}</option>
                <option value="22">{{22:00}}</option>
                <option value="23">{{23:00}}</option>
                <option value="0">{{24:00}}</option>
              </select></td>
          </tr>
          </table>
        </form>
        </fieldset>
          
        <fieldset>
        <form>      
          <legend>{{Display Settings}}</legend>
          <table width="100%">
          <tr>
            <td><label for="uiLanguage" class="label">{{App Language}}:</label></td>
            <td><select id="uiLanguage"></select></td>
          </tr>
          <tr>
            <td><label for="fontSize" class="label">{{Font Size}}:</label></td>
            <td><select id="fontSize">
              <option value="50">{{50%}}</option>
              <option value="60">{{60%}}</option>
              <option value="70">{{70%}}</option>
              <option value="80">{{80%}}</option>
              <option value="90">{{90%}}</option>
              <option value="100">{{100%}}</option>
              <option value="110">{{110%}}</option>
              <option value="120">{{120%}}</option>
              <option value="130">{{130%}}</option>
              <option value="140">{{140%}}</option>
              <option value="150">{{150%}}</option>
              <option value="160">{{160%}}</option>
              <option value="170">{{170%}}</option>
              <option value="180">{{180%}}</option>
              <option value="200">{{200%}}</option>
            </select></td>
          </tr>
          <tr>
            <td><label for="colorTheme" class="label">{{Text color}}:</label></td>
            <td><select id="colorTheme">
              <option value="light">{{Black text on white background}}</option>
              <option value="dark">{{White text on black background}}</option>
            </select></td>
          </tr>
          </table>
        </form>        
        </fieldset>        
        <br />
        <div class="center buttons">
          <a href="#" id="cancelBtn">{{Cancel}}</a><a href="#" id="saveBtn">{{Save}}</a>
        </div>
        </div></div>
        
      </div>
      <div id="infoTab" class="tabcontent hiddenOnStartup">
        {{About_Text}}
      </div>
    </div>

    <div id="footer" class="footer">
      <div class="tabs">
        <ul class="tab hiddenOnStartup">
        <li class="active"><a href="javascript:void(0)" class="tablinks" onclick="UI.openTab('homeTab')" id="homeTabBtn">{{Verse of the Day}}</a>
        </li><li><a href="javascript:void(0)" class="tablinks" onclick="UI.openTab('textTab')" id="textTabBtn">{{Full Text}}</a>
        </li><li><a href="javascript:void(0)" class="tablinks" onclick="UI.openTab('favoritesTab')" id="favoritesTabBtn">{{Favorite Verses}}</a>
        </li><li><a href="javascript:void(0)" class="tablinks" onclick="UI.openTab('settingsTab')" id="settingsTabBtn">{{Settings}}</a>
        </li><li><a href="javascript:void(0)" class="tablinks" onclick="UI.openTab('infoTab')" id="infoTabBtn">{{About}}</a></li>
        </ul>
      </div> 
    </div>
  </div>


 <script src="cordova.js" charset="UTF-8"></script>
</body>
</html>
